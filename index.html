<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×”××•× ×•×¤×•×œ ×”×§×™×‘×•×¦×™</title>
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #f0f8ff, #e6f3ff);
            margin: 0;
            padding: 20px;
            direction: rtl;
        }
        
        .game-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .board-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            padding: 20px;
        }
        
        .board {
            display: grid;
            width: 700px;
            height: 700px;
            grid-template-columns: 100px repeat(5, 1fr) 100px;
            grid-template-rows: 100px repeat(5, 1fr) 100px;
            gap: 0;
            border: 4px solid #2e7d32;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .square {
            background: #f9f9f9;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 8px;
            text-align: center;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 3px;
            border: 1px solid #2e7d32;
        }
        
        .square:hover {
            background: #e6f3ff;
        }
        
        /* ×”×’×¨×™×“ ×”×ª×•×§×Ÿ - ××™×§×•××™× × ×›×•× ×™× ×œ×›×œ 24 ×”××©×‘×¦×•×ª */
        #square-0 { grid-column: 1; grid-row: 7; }   /* ×©×¢×¨ ×”×§×™×‘×•×¥ - START */
        #square-1 { grid-column: 2; grid-row: 7; }
        #square-2 { grid-column: 3; grid-row: 7; }
        #square-3 { grid-column: 4; grid-row: 7; }
        #square-4 { grid-column: 5; grid-row: 7; }
        #square-5 { grid-column: 6; grid-row: 7; }
        #square-6 { grid-column: 7; grid-row: 7; }   /* ××§×œ×˜ - CORNER */
        #square-7 { grid-column: 7; grid-row: 6; }
        #square-8 { grid-column: 7; grid-row: 5; }
        #square-9 { grid-column: 7; grid-row: 4; }
        #square-10 { grid-column: 7; grid-row: 3; }
        #square-11 { grid-column: 7; grid-row: 2; }
        #square-12 { grid-column: 7; grid-row: 1; }  /* ×”×¢×¥ ×”×§×¡×•× - CORNER */
        #square-13 { grid-column: 6; grid-row: 1; }
        #square-14 { grid-column: 5; grid-row: 1; }
        #square-15 { grid-column: 4; grid-row: 1; }
        #square-16 { grid-column: 3; grid-row: 1; }
        #square-17 { grid-column: 2; grid-row: 1; }
        #square-18 { grid-column: 1; grid-row: 1; }  /* ×ª×•×¨× ×•×ª ×©××™×¨×” - CORNER */
        #square-19 { grid-column: 1; grid-row: 2; }
        #square-20 { grid-column: 1; grid-row: 3; }
        #square-21 { grid-column: 1; grid-row: 4; }
        #square-22 { grid-column: 1; grid-row: 5; }
        #square-23 { grid-column: 1; grid-row: 6; }
        
        /* ×¡×•×’×™ ××©×‘×¦×•×ª */
        .corner {
            background: linear-gradient(135deg, #ffd700, #ffed4a) !important;
            font-weight: bold;
            font-size: 10px;
            border: 3px solid #f39c12 !important;
        }
        
        .property {
            background: #e3f2fd;
            border-top: 12px solid #2196f3 !important;
        }
        
        .public-property {
            background: #f3e5f5;
            border-top: 12px solid #9c27b0 !important;
        }
        
        .special-property {
            background: #fff3e0;
            border-top: 12px solid #ff9800 !important;
        }
        
        .tax {
            background: #ffebee;
            border-top: 12px solid #f44336 !important;
            color: #d32f2f;
        }
        
        .card-space {
            background: #e8f5e8;
            border-top: 12px solid #4caf50 !important;
        }
        
        /* ×’×‘×•×œ×•×ª ×¦×‘×¢×•× ×™×™× ×œ×¢××•×“×•×ª ×¦×™×“×™×•×ª */
        .left-tile.property { border-top: none !important; border-right: 12px solid #2196f3 !important; }
        .left-tile.special-property { border-top: none !important; border-right: 12px solid #ff9800 !important; }
        .left-tile.card-space { border-top: none !important; border-right: 12px solid #4caf50 !important; }
        .left-tile.public-property { border-top: none !important; border-right: 12px solid #9c27b0 !important; }
        .left-tile.tax { border-top: none !important; border-right: 12px solid #f44336 !important; }
        
        .right-tile.property { border-top: none !important; border-left: 12px solid #2196f3 !important; }
        .right-tile.special-property { border-top: none !important; border-left: 12px solid #ff9800 !important; }
        .right-tile.card-space { border-top: none !important; border-left: 12px solid #4caf50 !important; }
        .right-tile.public-property { border-top: none !important; border-left: 12px solid #9c27b0 !important; }
        .right-tile.tax { border-top: none !important; border-left: 12px solid #f44336 !important; }
        
        /* ××–×•×¨ ×”×××¦×¢ */
        .center-area {
            grid-column: 2 / 7;
            grid-row: 2 / 7;
            background: #c8e6c9;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 30px;
            flex-direction: column;
        }
        
        .game-title {
            font-size: 20px;
            font-weight: bold;
            color: #2e7d32;
            text-align: center;
            transform: rotate(-15deg);
            background: linear-gradient(135deg, #ffd700, #ffed4a);
            padding: 10px 20px;
            border-radius: 10px;
            border: 2px solid #f39c12;
            box-shadow: 0 3px 6px rgba(0,0,0,0.2);
        }
        
        .card-decks {
            display: flex;
            gap: 20px;
        }
        
        .card-deck {
            width: 70px;
            height: 50px;
            background: #fff;
            border: 2px solid #2e7d32;
            border-radius: 5px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 9px;
            font-weight: bold;
            color: #2e7d32;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .card-deck:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        
        .card-deck.community {
            background: linear-gradient(135deg, #ff9800, #f57c00);
            color: white;
            border-color: #ef6c00;
        }
        
        .card-deck.kibbutz {
            background: linear-gradient(135deg, #2196f3, #1976d2);
            color: white;
            border-color: #0d47a1;
        }
        
        .player-token {
            position: absolute;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            border: 2px solid #333;
            transition: all 0.3s ease;
            z-index: 10;
            font-weight: bold;
        }
        
        .token-0 { background: #ff4757; color: white; }
        .token-1 { background: #2ed573; color: white; }
        .token-2 { background: #3742fa; color: white; }
        .token-3 { background: #ffa502; color: white; }
        
        .game-info {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            padding: 20px;
            min-width: 300px;
            height: fit-content;
        }
        
        .player-info {
            background: #f8f9fa;
            margin: 10px 0;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }
        
        .player-info.current-player {
            border-color: #007bff;
            background: #e3f2fd;
        }
        
        .dice-container {
            text-align: center;
            margin: 20px 0;
        }
        
        .dice {
            display: inline-block;
            margin: 0 10px;
            width: 40px;
            height: 40px;
            background: white;
            border: 2px solid #333;
            border-radius: 5px;
            font-size: 24px;
            text-align: center;
            line-height: 36px;
            font-weight: bold;
        }
        
        .roll-button {
            background: #28a745;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px 0;
        }
        
        .roll-button:hover {
            background: #218838;
            transform: translateY(-2px);
        }
        
        .roll-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background-color: white;
            margin: 15% auto;
            padding: 20px;
            border-radius: 10px;
            width: 400px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .close {
            color: #aaa;
            float: left;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close:hover {
            color: black;
        }
        
        .setup-screen {
            text-align: center;
            padding: 50px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .setup-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 15px 30px;
            margin: 10px;
            border-radius: 25px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .setup-button:hover {
            background: #0056b3;
            transform: translateY(-2px);
        }
        
        .property-price {
            font-size: 6px;
            color: #666;
            margin-top: 1px;
        }
        
        .owned-property {
            background: #fff59d !important;
            border: 2px solid #ff9800 !important;
        }
    </style>
</head>
<body>
    <!-- ××¡×š ×”×ª×—×œ×” -->
    <div id="setup" class="setup-screen">
        <h1>ğŸ˜ï¸ ×”××•× ×•×¤×•×œ ×”×§×™×‘×•×¦×™ ğŸ˜ï¸</h1>
        <h2>×‘×—×¨ ××¡×¤×¨ ×©×—×§× ×™×:</h2>
        <button class="setup-button" onclick="startGame(2)">2 ×©×—×§× ×™×</button>
        <button class="setup-button" onclick="startGame(4)">4 ×©×—×§× ×™×</button>
    </div>

    <!-- ××©×—×§ -->
    <div id="game" class="game-container" style="display: none;">
        <div class="board-container">
            <div class="board" id="board">
                <!-- ××–×•×¨ ×”×××¦×¢ -->
                <div class="center-area">
                    <div class="game-title">×”××•× ×•×¤×•×œ ×”×§×™×‘×•×¦×™</div>
                    <div class="card-decks">
                        <div class="card-deck community" onclick="showDeckInfo('community')">
                            <div>ğŸ˜ï¸</div>
                            <div>×§×”×™×œ×”</div>
                        </div>
                        <div class="card-deck kibbutz" onclick="showDeckInfo('kibbutz')">
                            <div>ğŸ›ï¸</div>
                            <div>×©×™×—×ª ×§×™×‘×•×¥</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="game-info">
            <h2>××™×“×¢ ××©×—×§</h2>
            <div id="current-turn">×ª×•×¨ ×©×—×§×Ÿ 1</div>
            
            <div class="dice-container">
                <div class="dice" id="dice1">1</div>
                <div class="dice" id="dice2">1</div>
                <br>
                <button class="roll-button" id="roll-btn" onclick="rollDice()">×–×¨×•×§ ×§×•×‘×™×•×ª</button>
            </div>
            
            <div id="players-info"></div>
            <div id="game-log"></div>
        </div>
    </div>

    <!-- ×—×œ×•×Ÿ ×§×œ×¤×™× -->
    <div id="card-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeCard()">&times;</span>
            <h3 id="card-title"></h3>
            <p id="card-text"></p>
            <button class="setup-button" onclick="closeCard()">×¡×’×•×¨</button>
        </div>
    </div>

    <!-- ×—×œ×•×Ÿ ×§× ×™×™×” -->
    <div id="buy-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeBuyModal()">&times;</span>
            <h3 id="buy-title"></h3>
            <p id="buy-text"></p>
            <button class="setup-button" onclick="buyProperty()">×§× ×”</button>
            <button class="setup-button" onclick="closeBuyModal()">×“×œ×’</button>
        </div>
    </div>

    <script>
        // ××©×ª× ×™× ×’×œ×•×‘×œ×™×™×
        let gameState = {
            players: [],
            currentPlayer: 0,
            numPlayers: 0,
            board: [],
            communityCards: [],
            kibbutzCards: [],
            communityDeck: [],
            kibbutzDeck: [],
            gameStarted: false
        };

        // × ×ª×•× ×™ ×”×œ×•×— - ×›×œ 24 ×”××©×‘×¦×•×ª ×”×—×“×©×•×ª
        const boardData = [
            {id: 1, name: "×©×¢×¨ ×”×§×™×‘×•×¥", type: "×¤×™× ×”", special: "start"},
            {id: 2, name: "×©×‘×™×œ ×”×•×ª×™×§×™×", type: "× ×›×¡", price: 60, rent: 6},
            {id: 3, name: "×§×•××•×ª×™×™×", type: "× ×›×¡", price: 80, rent: 8},
            {id: 4, name: "×§×”×™×œ×”", type: "×§×œ×£", cardType: "community"},
            {id: 5, name: "×“×™×¨×ª ×™×•×¨×©×™× ×××¦×¢×™×ª", type: "× ×›×¡", price: 100, rent: 15},
            {id: 6, name: "×“×™×¨×ª ×™×•×¨×©×™× ×¤×™× ×ª×™×ª", type: "× ×›×¡", price: 120, rent: 20}, // NEW
            {id: 7, name: "××§×œ×˜", type: "×¤×™× ×”", special: "jail"},
            {id: 8, name: "××™×¡×™ ×§×”×™×œ×”", type: "××™×¡×™×", tax: 100},
            {id: 9, name: "×¨×¤×ª", type: "× ×›×¡ ××™×•×—×“", rule: "×©×›×™×¨×•×ª ×œ×¤×™ ×§×•×‘×™×™×”", price: 150},
            {id: 10, name: "×©×™×—×ª ×§×™×‘×•×¥", type: "×§×œ×£", cardType: "kibbutz"},
            {id: 11, name: "×‘× ×” ×‘×ª×š", type: "× ×›×¡", price: 150, rent: 25},
            {id: 12, name: "MCP", type: "× ×›×¡ ××™×•×—×“", rule: "×©×›×™×¨×•×ª ×œ×¤×™ ×§×•×‘×™×™×”", price: 180}, // NEW
            {id: 13, name: "×”×¢×¥ ×”×§×¡×•×", type: "×¤×™× ×”", special: "parking"},
            {id: 14, name: "×”×¨×—×‘×” ×¢× ×©×˜×— ×¦×™×‘×•×¨×™", type: "× ×›×¡", price: 180, rent: 35},
            {id: 15, name: "××˜×¢ ××‘×•×§×“×•", type: "× ×›×¡ ××™×•×—×“", rule: "×©×›×™×¨×•×ª ×œ×¤×™ ×§×•×‘×™×™×”", price: 200},
            {id: 16, name: "×›×œ×‘×•", type: "× ×›×¡ ×¦×™×‘×•×¨×™", price: 220, rent: 50},
            {id: 17, name: "×§×”×™×œ×”", type: "×§×œ×£", cardType: "community"},
            {id: 18, name: "×¤××‘ ×”×¢×¨×•×‘×”", type: "× ×›×¡", price: 180, rent: 40}, // NEW
            {id: 19, name: "×ª×•×¨× ×•×ª ×©××™×¨×”", type: "×¤×™× ×”", rule: "×œ×š ×œ×©×¢×¨ ×”×§×™×‘×•×¥", special: "gotojail"},
            {id: 20, name: "××•×¢×“×•×Ÿ ×œ×—×‘×¨", type: "× ×›×¡", price: 250, rent: 45}, // NEW
            {id: 21, name: "×’×Ÿ ×©×¢×©×•×¢×™×", type: "× ×›×¡ ×¦×™×‘×•×¨×™", price: 200, rent: 45},
            {id: 22, name: "×©×™×—×ª ×§×™×‘×•×¥", type: "×§×œ×£", cardType: "kibbutz"},
            {id: 23, name: "×‘×¨×™×›×”", type: "× ×›×¡ ×¦×™×‘×•×¨×™", price: 240, rent: 60},
            {id: 24, name: "××•×¢×“×•×Ÿ ×œ×—×‘×¨ ×¤×¨××™×•×", type: "× ×›×¡", price: 280, rent: 50}
        ];

        // ×§×œ×¤×™ ×§×”×™×œ×”
        const communityCardsData = [
            {text: "× ×ª×¤×¡×ª ×’×•× ×‘ ××¢×“×Ÿ ×—×œ×‘ ××”×›×•×œ×‘×• â€“ ×©×œ× 100 â‚ª", action: "pay", amount: 100},
            {text: "×¨×—×¤×Ÿ ×ª×¤×¡ ××•×ª×š ×œ× ××•×¡×£ ×§×§×™ â€“ ×©×œ× 50 â‚ª", action: "pay", amount: 50},
            {text: "×©×‘×ª ×—×ª×Ÿ ×‘×‘×¨×™×›×” â€“ ×§×‘×œ 150 â‚ª", action: "receive", amount: 150},
            {text: "××ª× ×•×ª ×¡×•×£ ×©× ×” ×œ×’× × ×•×ª â€“ ×©×œ× 100 â‚ª", action: "pay", amount: 100},
            {text: "×’× ×™×‘×ª ×× ×’×• ××ª×•×¢×“×ª â€“ ×©×œ× 50 â‚ª ×œ×›×œ ×©×—×§×Ÿ", action: "payAll", amount: 50},
            {text: "×¢×¨×‘ ×©×™×¨×” ×‘×¦×™×‘×•×¨ â€“ ×§×‘×œ 100 â‚ª", action: "receive", amount: 100},
            {text: "× ×¤×˜×¨×ª ××—×¤×¦×™× ×‘×§×‘×•×¦×ª ×™×“ 2 â€“ ×§×‘×œ 50 â‚ª", action: "receive", amount: 50},
            {text: "×”××¦×™×œ ×ª×¤×¡ ××ª ×”×™×œ×“ ×‘×¢××•×§×™× â€“ ×©×œ× 100 â‚ª", action: "pay", amount: 100},
            {text: "×’×¨×¨×ª ××ª ×¡×‘×ª× ×œ×›×œ×‘×• â€“ ×§×‘×œ 100 â‚ª ×•×”×ª×§×“× ×œ\"×›×œ×‘×•\"", action: "moveAndReceive", target: 15, amount: 100},
            {text: "×¢×‘×¨×ª ×œ×™×“ ×”×’×Ÿ ×©×œ ×”×™×œ×“ â€“ ×—×–×•×¨ 3 ××©×‘×¦×•×ª ××—×•×¨×”", action: "moveBack", amount: 3},
            {text: "×§×™×‘×œ×ª ××™× ×•×™ ××“××™×Ÿ â€“ ×›×œ ×©×—×§×Ÿ ××©×œ× ×œ×š 50 â‚ª", action: "receiveFromAll", amount: 50}
        ];

        // ×§×œ×¤×™ ×©×™×—×ª ×§×™×‘×•×¥
        const kibbutzCardsData = [
            {text: "×—×•×§ ×”×©×™×•×š ×¢×‘×¨ â€“ ×¢×“ ×’×™×œ 18 ×©×œ× 300 â‚ª, ××¢×œ ×’×™×œ 18 ×©×œ× 50 â‚ª", action: "pay", amount: 50},
            {text: "××•×¢×¦×” ×”×˜×™×œ×” ××¡ ×©×§×¨ ×›×œ×©×”×• â€“ ×× ×™×© ×œ×š × ×›×¡ ×¤×¨×˜×™ ×©×œ× 150 â‚ª", action: "payIfOwns", amount: 150},
            {text: "×•×¢×“×ª ×ª×›× ×•×Ÿ ×©×•×‘ ×©×™× ×ª×” ××ª ×©×‘×™×œ ×”×•×•×ª×™×§×™× â€“ ×©×œ× 150 â‚ª", action: "pay", amount: 150},
            {text: "×”×©×ª×ª×¤×ª ×‘×©×™×—×ª ×§×™×‘×•×¥ ××¨×•×›×” â€“ ×“×œ×’ ×¢×œ ×ª×•×¨ ××—×“", action: "skipTurn", amount: 0},
            {text: "× ××¦× ×—×•×‘ ×‘×Ÿ 80 ×©× ×” â€“ ×©×œ× 120 â‚ª", action: "pay", amount: 120},
            {text: "×”×•×–×× ×ª ×œ×™×©×™×‘×ª ×—×™×¨×•× â€“ ×”×ª×§×“× ×œ\"××•×¢×“×•×Ÿ ×œ×—×‘×¨\"", action: "moveTo", target: 19},
            {text: "×¢×‘×¨×• ×©× ×” ×•×¢×“×™×™×Ÿ ××™×Ÿ ××§×œ×˜×™× â€“ ×©×œ× 50 â‚ª", action: "pay", amount: 50},
            {text: "×”×•×•×¢×“ ×”×¡×›×™× ××™×ª×š â€“ ×”×ª×§×“× ×œ×‘×¨×™×›×” ×•×§×‘×œ 50 â‚ª", action: "moveAndReceive", target: 22, amount: 50}
        ];

        // ××ª×—×•×œ ×”××©×—×§
        function startGame(numPlayers) {
            gameState.numPlayers = numPlayers;
            gameState.gameStarted = true;
            
            const tokens = ['ğŸ©', 'ğŸš²', 'ğŸ›º', 'ğŸšœ'];
            for (let i = 0; i < numPlayers; i++) {
                gameState.players.push({
                    id: i,
                    name: `×©×—×§×Ÿ ${i + 1}`,
                    money: 750,
                    position: 0,
                    properties: [],
                    token: tokens[i],
                    skipTurn: false
                });
            }
            
            gameState.board = [...boardData];
            gameState.communityCards = [...communityCardsData];
            gameState.kibbutzCards = [...kibbutzCardsData];
            gameState.communityDeck = [...communityCardsData];
            gameState.kibbutzDeck = [...kibbutzCardsData];
            
            shuffleDeck(gameState.communityDeck);
            shuffleDeck(gameState.kibbutzDeck);
            
            document.getElementById('setup').style.display = 'none';
            document.getElementById('game').style.display = 'flex';
            
            createBoard();
            createPlayers();
            updateDisplay();
        }

        function createBoard() {
            const board = document.getElementById('board');
            
            gameState.board.forEach((square, index) => {
                const squareEl = document.createElement('div');
                let className = 'square ';
                
                // ×”×•×¡×¤×ª classes ×œ×¦×“×“×™×
                if ([18,19,20,21,22,23].includes(index)) {
                    className += 'left-tile ';
                }
                if ([7,8,9,10,11].includes(index)) {
                    className += 'right-tile ';
                }
                
                switch (square.type) {
                    case '×¤×™× ×”':
                        className += 'corner';
                        break;
                    case '× ×›×¡':
                        className += 'property';
                        break;
                    case '× ×›×¡ ×¦×™×‘×•×¨×™':
                        className += 'public-property';
                        break;
                    case '× ×›×¡ ××™×•×—×“':
                        className += 'special-property';
                        break;
                    case '××™×¡×™×':
                        className += 'tax';
                        break;
                    case '×§×œ×£':
                        className += 'card-space';
                        break;
                }
                
                squareEl.className = className;
                squareEl.id = `square-${index}`;
                
                let content = `<div style="font-weight: bold; margin-bottom: 1px; font-size: 7px;">${square.name}</div>`;
                
                if (square.price > 0) {
                    content += `<div class="property-price">â‚ª${square.price}</div>`;
                }
                if (square.rent > 0) {
                    content += `<div class="property-price">×©×›×™×¨×•×ª: â‚ª${square.rent}</div>`;
                }
                if (square.tax > 0) {
                    content += `<div class="property-price">××¡: â‚ª${square.tax}</div>`;
                }
                if (square.rule) {
                    content += `<div class="property-price">${square.rule}</div>`;
                }
                
                squareEl.innerHTML = content;
                board.appendChild(squareEl);
            });
        }

        function createPlayers() {
            gameState.players.forEach((player, index) => {
                const token = document.createElement('div');
                token.className = `player-token token-${index}`;
                token.id = `token-${index}`;
                token.textContent = player.token;
                
                positionToken(index, 0);
                
                document.getElementById('board').appendChild(token);
            });
        }

        function positionToken(playerIndex, squareIndex) {
            const token = document.getElementById(`token-${playerIndex}`);
            const square = document.getElementById(`square-${squareIndex}`);
            
            if (!token || !square) return;
            
            const squareRect = square.getBoundingClientRect();
            const boardRect = document.getElementById('board').getBoundingClientRect();
            
            const offsetX = (playerIndex % 2) * 26;
            const offsetY = Math.floor(playerIndex / 2) * 26;
            
            token.style.left = (squareRect.left - boardRect.left + offsetX + 5) + 'px';
            token.style.top = (squareRect.top - boardRect.top + offsetY + 5) + 'px';
        }

        function showDeckInfo(type) {
            const deckSize = type === 'community' ? gameState.communityDeck.length : gameState.kibbutzDeck.length;
            const deckName = type === 'community' ? '×§×”×™×œ×”' : '×©×™×—×ª ×§×™×‘×•×¥';
            alert(`×¢×¨××ª ${deckName}\n× ×©××¨×• ${deckSize} ×§×œ×¤×™×`);
        }

        function rollDice() {
            const dice1 = Math.floor(Math.random() * 6) + 1;
            const dice2 = Math.floor(Math.random() * 6) + 1;
            const total = dice1 + dice2;
            
            document.getElementById('dice1').textContent = dice1;
            document.getElementById('dice2').textContent = dice2;
            document.getElementById('roll-btn').disabled = true;
            
            addLog(`${gameState.players[gameState.currentPlayer].name} ×–×¨×§ ${dice1} + ${dice2} = ${total}`);
            
            setTimeout(() => {
                movePlayer(total);
                setTimeout(() => {
                    handleSquare();
                }, 1000);
            }, 1000);
        }

        function movePlayer(steps) {
            const player = gameState.players[gameState.currentPlayer];
            const oldPosition = player.position;
            player.position = (player.position + steps) % 24; // Updated for 24 tiles
            
            if (player.position < oldPosition) {
                player.money += 100;
                addLog(`${player.name} ×¢×‘×¨ ×‘×©×¢×¨ ×”×§×™×‘×•×¥ ×•×§×™×‘×œ 100 â‚ª`);
            }
            
            positionToken(gameState.currentPlayer, player.position);
            updateDisplay();
            
            addLog(`${player.name} ×”×’×™×¢ ×œ××©×‘×¦×ª: ${gameState.board[player.position].name}`);
        }

        function handleSquare() {
            const player = gameState.players[gameState.currentPlayer];
            const square = gameState.board[player.position];
            
            switch (square.type) {
                case '× ×›×¡':
                case '× ×›×¡ ×¦×™×‘×•×¨×™':
                    handleProperty(square, player.position);
                    break;
                case '× ×›×¡ ××™×•×—×“':
                    handleSpecialProperty(square, player.position);
                    break;
                case '×§×œ×£':
                    drawCard(square.cardType);
                    break;
                case '××™×¡×™×':
                    handleTax(square);
                    break;
                case '×¤×™× ×”':
                    handleCorner(square);
                    break;
                default:
                    nextTurn();
                    break;
            }
        }

        function handleProperty(square, squareIndex) {
            const player = gameState.players[gameState.currentPlayer];
            const owner = findPropertyOwner(squareIndex);
            
            if (!owner) {
                showBuyModal(square, squareIndex);
            } else if (owner.id !== player.id) {
                let rent = square.rent;
                
                // ×‘×“×™×§×ª ×‘×•× ×•×¡ ×“×™×¨×•×ª ×™×•×¨×©×™×
                const apartments = [1, 4, 5]; // ×“×™×¨×ª ×™×•×¨×©×™× ×××¦×¢×™×ª ×•×¤×™× ×ª×™×ª
                if (apartments.every(pos => findPropertyOwner(pos) && findPropertyOwner(pos).id === owner.id)) {
                    rent *= 2;
                    addLog(`×©×›×™×¨×•×ª ××•×›×¤×œ×ª ×›×™ ${owner.name} ××—×–×™×§ ×‘×›×œ ×”×“×™×¨×•×ª!`);
                }
                
                payRent(player, owner, rent);
                nextTurn();
            } else {
                nextTurn();
            }
        }

        function handleSpecialProperty(square, squareIndex) {
            const player = gameState.players[gameState.currentPlayer];
            const owner = findPropertyOwner(squareIndex);
            
            if (!owner) {
                showBuyModal(square, squareIndex);
            } else if (owner.id !== player.id) {
                const dice = Math.floor(Math.random() * 6) + 1;
                let rent;
                
                if (dice <= 2) rent = 10;
                else if (dice <= 4) rent = 20;
                else if (dice === 5) rent = 30;
                else rent = 50;
                
                // ×‘×“×™×§×ª ×‘×•× ×•×¡ × ×›×¡×™× ××™×•×—×“×™×
                const specialProps = [8, 11, 14]; // ×¨×¤×ª, MCP, ××˜×¢ ××‘×•×§×“×•
                const ownedSpecials = specialProps.filter(pos => findPropertyOwner(pos) && findPropertyOwner(pos).id === owner.id);
                if (ownedSpecials.length >= 2) {
                    rent *= 2;
                    addLog(`×©×›×™×¨×•×ª ××•×›×¤×œ×ª ×›×™ ${owner.name} ××—×–×™×§ ×‘× ×›×¡×™× ××™×•×—×“×™×!`);
                }
                
                addLog(`× ×–×¨×§×” ${dice} ×¢×œ ×”×§×•×‘×™×™×” - ×©×›×™×¨×•×ª: ${rent} â‚ª`);
                payRent(player, owner, rent);
                nextTurn();
            } else {
                nextTurn();
            }
        }

        function findPropertyOwner(squareIndex) {
            for (let player of gameState.players) {
                if (player.properties.includes(squareIndex)) {
                    return player;
                }
            }
            return null;
        }

        function payRent(payer, owner, amount) {
            payer.money -= amount;
            owner.money += amount;
            addLog(`${payer.name} ×©×™×œ× ${amount} â‚ª ×©×›×™×¨×•×ª ×œ${owner.name}`);
            checkBankruptcy(payer);
            updateDisplay();
        }

        function showBuyModal(square, squareIndex) {
            document.getElementById('buy-title').textContent = square.name;
            document.getElementById('buy-text').textContent = `××—×™×¨: ${square.price} â‚ª${square.rent ? `\n×©×›×™×¨×•×ª: ${square.rent} â‚ª` : ''}${square.rule ? `\n${square.rule}` : ''}`;
            document.getElementById('buy-modal').style.display = 'block';
            window.currentPurchase = {square, squareIndex};
        }

        function buyProperty() {
            const player = gameState.players[gameState.currentPlayer];
            const {square, squareIndex} = window.currentPurchase;
            
            if (player.money >= square.price) {
                player.money -= square.price;
                player.properties.push(squareIndex);
                document.getElementById(`square-${squareIndex}`).classList.add('owned-property');
                addLog(`${player.name} ×§× ×” ××ª ${square.name} ×‘-${square.price} â‚ª`);
            } else {
                addLog(`×œ${player.name} ××™×Ÿ ××¡×¤×™×§ ×›×¡×£ ×œ×§× ×•×ª ××ª ${square.name}`);
            }
            
            closeBuyModal();
            updateDisplay();
            nextTurn();
        }

        function closeBuyModal() {
            document.getElementById('buy-modal').style.display = 'none';
        }

        function drawCard(type) {
            let deck = type === 'community' ? gameState.communityDeck : gameState.kibbutzDeck;
            let cards = type === 'community' ? gameState.communityCards : gameState.kibbutzCards;
            
            if (deck.length === 0) {
                deck = [...cards];
                shuffleDeck(deck);
                if (type === 'community') gameState.communityDeck = deck;
                else gameState.kibbutzDeck = deck;
            }
            
            const card = deck.pop();
            showCard(card, type);
        }

        function showCard(card, type) {
            document.getElementById('card-title').textContent = type === 'community' ? '×§×”×™×œ×”' : '×©×™×—×ª ×§×™×‘×•×¥';
            document.getElementById('card-text').textContent = card.text;
            document.getElementById('card-modal').style.display = 'block';
            window.currentCard = card;
        }

        function closeCard() {
            document.getElementById('card-modal').style.display = 'none';
            if (window.currentCard) {
                executeCardAction(window.currentCard);
                window.currentCard = null;
            }
            setTimeout(() => nextTurn(), 500);
        }

        function executeCardAction(card) {
            const player = gameState.players[gameState.currentPlayer];
            
            switch (card.action) {
                case 'pay':
                    player.money -= card.amount;
                    addLog(`${player.name} ×©×™×œ× ${card.amount} â‚ª`);
                    break;
                case 'receive':
                    player.money += card.amount;
                    addLog(`${player.name} ×§×™×‘×œ ${card.amount} â‚ª`);
                    break;
                case 'payAll':
                    gameState.players.forEach(p => {
                        if (p.id !== player.id) {
                            player.money -= card.amount;
                            p.money += card.amount;
                        }
                    });
                    addLog(`${player.name} ×©×™×œ× ${card.amount} â‚ª ×œ×›×œ ×©×—×§×Ÿ`);
                    break;
                case 'receiveFromAll':
                    gameState.players.forEach(p => {
                        if (p.id !== player.id) {
                            p.money -= card.amount;
                            player.money += card.amount;
                        }
                    });
                    addLog(`${player.name} ×§×™×‘×œ ${card.amount} â‚ª ××›×œ ×©×—×§×Ÿ`);
                    break;
                case 'skipTurn':
                    player.skipTurn = true;
                    addLog(`${player.name} ×™×“×œ×’ ×¢×œ ×”×ª×•×¨ ×”×‘×`);
                    break;
                case 'moveTo':
                    player.position = card.target;
                    positionToken(gameState.currentPlayer, player.position);
                    addLog(`${player.name} ×¢×‘×¨ ×œ××©×‘×¦×ª ${gameState.board[card.target].name}`);
                    break;
                case 'moveAndReceive':
                    player.position = card.target;
                    player.money += card.amount;
                    positionToken(gameState.currentPlayer, player.position);
                    addLog(`${player.name} ×¢×‘×¨ ×œ××©×‘×¦×ª ${gameState.board[card.target].name} ×•×§×™×‘×œ ${card.amount} â‚ª`);
                    break;
                case 'moveBack':
                    player.position = (player.position - card.amount + 24) % 24;
                    positionToken(gameState.currentPlayer, player.position);
                    addLog(`${player.name} ×—×–×¨ ${card.amount} ××©×‘×¦×•×ª ××—×•×¨×”`);
                    break;
                case 'payIfOwns':
                    if (player.properties.length > 0) {
                        player.money -= card.amount;
                        addLog(`${player.name} ×©×™×œ× ${card.amount} â‚ª ×›×™ ×™×© ×œ×• × ×›×¡×™×`);
                    }
                    break;
            }
            
            checkBankruptcy(player);
            updateDisplay();
        }

        function handleTax(square) {
            const player = gameState.players[gameState.currentPlayer];
            player.money -= square.tax;
            addLog(`${player.name} ×©×™×œ× ${square.tax} â‚ª ××¡`);
            checkBankruptcy(player);
            updateDisplay();
            nextTurn();
        }

        function handleCorner(square) {
            const player = gameState.players[gameState.currentPlayer];
            
            switch (square.special) {
                case 'start':
                    addLog(`${player.name} × ×—×ª ×¢×œ ×©×¢×¨ ×”×§×™×‘×•×¥`);
                    break;
                case 'jail':
                    addLog(`${player.name} ××‘×§×¨ ×‘××§×œ×˜`);
                    break;
                case 'parking':
                    addLog(`${player.name} × ×—×ª ×¢×œ ×”×¢×¥ ×”×§×¡×•×`);
                    break;
                case 'gotojail':
                    player.position = 0;
                    positionToken(gameState.currentPlayer, 0);
                    addLog(`${player.name} × ×©×œ×— ×‘×ª×•×¨× ×•×ª ×©××™×¨×” ×•×—×•×–×¨ ×œ×©×¢×¨ ×”×§×™×‘×•×¥`);
                    break;
            }
            
            nextTurn();
        }

        function checkBankruptcy(player) {
            if (player.money <= 0) {
                addLog(`${player.name} ×¤×©×˜ ×¨×’×œ ×•×™×¦× ××”××©×—×§!`);
                
                player.properties.forEach(propIndex => {
                    document.getElementById(`square-${propIndex}`).classList.remove('owned-property');
                });
                
                const playerIndex = gameState.players.findIndex(p => p.id === player.id);
                gameState.players.splice(playerIndex, 1);
                
                if (gameState.currentPlayer >= gameState.players.length) {
                    gameState.currentPlayer = 0;
                }
                
                if (gameState.players.length === 1) {
                    endGame();
                    return;
                }
                
                document.getElementById(`token-${player.id}`).style.display = 'none';
            }
        }

        function nextTurn() {
            if (gameState.players.length === 0) return;
            
            if (gameState.players[gameState.currentPlayer]?.skipTurn) {
                gameState.players[gameState.currentPlayer].skipTurn = false;
                addLog(`${gameState.players[gameState.currentPlayer].name} ××“×œ×’ ×¢×œ ×”×ª×•×¨`);
            }
            
            gameState.currentPlayer = (gameState.currentPlayer + 1) % gameState.players.length;
            document.getElementById('roll-btn').disabled = false;
            updateDisplay();
        }

        function updateDisplay() {
            if (gameState.players.length === 0) return;
            
            document.getElementById('current-turn').textContent = 
                `×ª×•×¨ ${gameState.players[gameState.currentPlayer].name}`;
            
            const playersInfo = document.getElementById('players-info');
            playersInfo.innerHTML = '';
            
            gameState.players.forEach((player, index) => {
                const playerDiv = document.createElement('div');
                playerDiv.className = `player-info ${index === gameState.currentPlayer ? 'current-player' : ''}`;
                
                const properties = player.properties.map(p => gameState.board[p].name).join(', ');
                
                playerDiv.innerHTML = `
                    <strong>${player.token} ${player.name}</strong><br>
                    ×›×¡×£: ${player.money} â‚ª<br>
                    × ×›×¡×™×: ${properties || '××™×Ÿ'}
                `;
                
                playersInfo.appendChild(playerDiv);
            });
        }

        function addLog(message) {
            const log = document.getElementById('game-log');
            const logEntry = document.createElement('div');
            logEntry.textContent = message;
            logEntry.style.margin = '5px 0';
            logEntry.style.padding = '5px';
            logEntry.style.background = '#f8f9fa';
            logEntry.style.borderRadius = '5px';
            
            log.insertBefore(logEntry, log.firstChild);
            
            while (log.children.length > 10) {
                log.removeChild(log.lastChild);
            }
        }

        function shuffleDeck(deck) {
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
        }

        function endGame() {
            const winner = gameState.players[0];
            alert(`ğŸ† ${winner.name} × ×™×¦×— ×‘××©×—×§ ×¢× ${winner.money} â‚ª! ğŸ†`);
            
            if (confirm('×”×× ×ª×¨×¦×” ×œ×©×—×§ ×©×•×‘?')) {
                location.reload();
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            window.onclick = function(event) {
                if (event.target === document.getElementById('card-modal')) {
                    closeCard();
                }
                if (event.target === document.getElementById('buy-modal')) {
                    closeBuyModal();
                }
            }
        });
    </script>
</body>
</html>
